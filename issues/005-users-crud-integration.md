# 📌 Users CRUD 統合テスト（4 ステップ網羅）

## 目的（なぜやるか／価値）

追加 → 一覧 → 編集 → 削除のユーザーフロー全体を自動で保証する。

Issue #002 で基本的な追加・削除フローを確保した後、ユーザー管理の全ライフサイクルを統合テストで網羅します。これにより：

- **完全性**: ユーザー管理の全操作（CRUD すべて）を自動保証
- **実用性**: 実際の運用フローに近いシナリオをテスト
- **堅牢性**: 複雑なステート管理やデータの整合性を検証
- **安心感**: リファクタリングや機能追加を自信を持って実施できる

## 受け入れ基準（Definition of Done）

- [ ] モック API と DB リセット機構を併用した 4 ステップフローを実装
  - ユーザー追加 → 一覧表示確認 → 編集 → 削除
- [ ] Playwright E2E テストが CI で安定して通しでパスする
- [ ] テスト前後のデータクリーンアップが自動化されている
- [ ] 編集フローで変更内容が正しく保存・表示されることを確認
- [ ] テストが 90 秒以内に完了する
- [ ] テスト失敗時のスクリーンショット・トレースを保存

## 目安工数

- [ ] S（小）
- [x] M（中）
- [ ] L（大）

## タスク例

- [ ] `tests/e2e/users-crud-integration.spec.ts` を作成
- [ ] テストデータの準備（beforeEach）
  - モックユーザーデータの初期化
  - DB リセット処理
- [ ] ステップ 1: ユーザー追加
  - フォームオープン
  - 全必須フィールド入力（名前、所属、権限など）
  - 送信 → 成功メッセージ確認
- [ ] ステップ 2: 一覧表示確認
  - ユーザー一覧ページに遷移
  - 追加したユーザーがリストに表示されることを確認
- [ ] ステップ 3: 編集
  - ユーザーを選択 → 編集ダイアログオープン
  - 一部フィールドを変更（例: 名前、メールアドレス）
  - 保存 → 変更が反映されることを確認
- [ ] ステップ 4: 削除
  - ユーザーを選択 → 削除ボタン
  - 確認ダイアログで OK → リストから消えることを確認
- [ ] テストクリーンアップ（afterEach）
  - テストデータの削除
- [ ] CI ワークフローにテストを追加

## 備考

関連ファイル:
- `src/features/users/UsersPanel.tsx` - ユーザー一覧・管理画面
- `src/features/users/UserForm.tsx` - ユーザー追加/編集フォーム
- `src/features/users/store.ts` - ユーザーストア（デモ用 In-Memory 状態管理）
- `src/features/users/useUsers.ts` - ユーザーフック（SharePoint 連携 / 本番想定）
- `tests/e2e/users.smoke.spec.ts` - 既存のユーザーテスト参考
- `issues/002-users-crud-smoke.md` - 前提となる基本回帰テスト

前提条件:
- Issue #002（Users CRUD 基本回帰テスト）が完了していること
- モック API の安定性が確保されていること

参考:
- [Playwright Test Fixtures](https://playwright.dev/docs/test-fixtures)
- [E2E Test Strategy](../docs/E2E_TEST_STRATEGY.md)
