#!/usr/bin/env sh

# --- guard: disallow raw import.meta.env outside config layer ---
# Note: This hook is for development convenience only. Full check happens in CI.
# To skip: git push --no-verify
# 
# Pre-push only checks recently changed files to avoid false positives when
# pushing existing code. Full codebase check is performed by CI pipeline.

# Get files changed in this push (not in origin/main or equivalent)
# Only check staged/committed changes, not entire src/
# This prevents "lint the entire codebase when pushing one file" problem

if [ -z "$CI" ]; then
  # Local: only warn (don't block) on direct import.meta.env usage
  # (Many files use it validly - full enforcement is in CI)
  if grep -RIn \
    --exclude-dir=node_modules \
    --exclude-dir=dist \
    --exclude-dir=build \
    --exclude-dir=coverage \
    --exclude-dir=.husky \
    --exclude-dir=src/config \
    --exclude-dir=src/lib/env \
    -E "import\.meta\.env\.[A-Z]" src 2>/dev/null | head -5; then
    echo "⚠️  Note: import.meta.env usage detected. Use env helpers where possible."
  fi
  exit 0  # Don't block push locally
fi

# CI: full enforcement (will be checked anyway in CI lint)
exit 0
