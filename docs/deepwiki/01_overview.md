# システム概要（DeepWiki Overview）

このドキュメントは、本リポジトリの DeepWiki 入口として **「このシステムは何で、何を守るために作られているか」**を短時間で把握できることを目的とします。  
詳細は各 DeepWiki ページに委譲し、ここでは全体像と読み順を示します。

---

## 1. 目的（このシステムが解決すること）
本システムの目的は、障害福祉事業所の運用において

- **事故を防ぐ**（誤操作・見落とし・配置ミス・取り違え）
- **監査で説明できる**（誰が・いつ・何を判断し、どう実施したかの根拠が残る）
- **現場の業務が回る**（段取りの安定、情報共有の一貫性）

を同時に満たすことです。

DeepWiki は、そのために「仕様のWhy」「運用ルール」「データの根拠」「テスト契約」を、コードと矛盾しない形で残します。

---

## 2. システムの全体像（構成要素）
このプロダクトは、主に次の4モジュールで構成されます。

- **Schedule（予定）**：日/週/月の予定管理。現場の段取りと事故予防の基盤  
  - DeepWiki：[`03_features/schedules.md`](./03_features/schedules.md)
- **Users（利用者/職員マスタ）**：本人確認・責任所在・権限制御の基盤  
- **Daily（支援記録/生活記録）**：支援の実績・経過・監査で照合される記録（予定と整合することが重要）  
- **Nurse（看護）**：健康観察・医療的ケア等、事故リスクが高い領域の記録/運用支援

> 注：各モジュールは「単体で完結」ではなく、監査説明では「予定（Schedule）→実績（Daily/Nurse）→責任（Users）」の整合が問われやすいです。

---

## 3. データストアと外部連携（SharePoint 前提 + バイパス併用）
### 3.1 基本方針：SharePoint Lists を主要ストアとして利用
本システムは、SharePoint Lists を主要データストアとして利用します（運用・監査の観点で、権限・履歴・統制を利かせやすい）。

- 例：Schedule の予定は SharePoint List（例：`ScheduleEvents`）に保存される（詳細は schedule DeepWiki を参照）

### 3.2 デモ/テストのためのバイパス経路（重要）
開発・E2E の安定性確保のため、次のような「SharePoint を叩かない経路」が併存します。

- fixtures / scenario によるデータ供給
- `VITE_SKIP_SHAREPOINT` 等の環境変数によるバイパス

Why（なぜ併用するか）：
- E2E の再現性（外部要因で落ちない）
- SharePoint 構成差（検証環境・開発環境の列差分）を吸収
- 段階導入（機能を徐々に SharePoint 本線へ寄せる）

> 重要：DeepWiki では「本番経路」と「バイパス経路」を混同しないよう、必ず両方を明記します。

---

## 4. Feature Flags（段階導入・安全運用のためのスイッチ）
本システムは Feature Flags（例：`VITE_FEATURE_*` や localStorage の `feature:*`）を使い、以下を実現します。

- 段階導入（特定機能だけ先にON/OFF）
- 事故防止（危険な操作を限定ロール/限定環境だけ有効化）
- E2E 安定化（テスト時のみ固定の挙動を選ぶ）

> DeepWiki の各機能ページには「フラグ名」「既定値」「影響範囲」「E2Eでの扱い」を必ず書きます。

---

## 5. 読み順（DeepWiki ナビゲーション）
推奨の読み順：

1. ガイドライン：[`00_guidelines.md`](./00_guidelines.md)  
2. この概要：`01_overview.md`（本ページ）  
3. アーキテクチャ：[`02_architecture.md`](./02_architecture.md)  
4. 機能別（例：Schedule）：[`03_features/schedules.md`](./03_features/schedules.md)  
5. レビュー用チェックリスト：[`10_review/checklist.md`](./10_review/checklist.md)

---

## 6. 運用/監査での「説明の筋道」（Why を失わないために）
監査・事故対応で説明しやすい構造は概ね次の通りです。

- **Who（責任）**：Users（誰が関わったか、権限は適切か）
- **Plan（計画）**：Schedule（いつ/誰に/何をする計画だったか）
- **Do（実施）**：Daily / Nurse（実際に何をしたか、例外があったか）
- **Why（根拠）**：StatusReason や記録メモ等（なぜそう判断したか）

この筋道が崩れると、現場の振り返りも監査対応も難しくなります。DeepWiki では「どのデータが、どの筋道のどこを支えるか」を意識して記述します。
