# PR マージ前チェックリスト

## 目的

- PR をマージする前に最低限確認すべき技術的および運用的チェック項目をまとめます。
- チーム共通のガイドラインとして参照してください。

---

## 必須チェック（CI）

- [ ] GitHub Actions / CI が全て Green（typecheck / build / lint / test）
- [ ] TypeScript 型チェックが通っている（`npx tsc --noEmit`）
- [ ] ビルドが通る（`npm run build`）
- [ ] Lint が通る（`npm run lint`）
- [ ] ユニットテスト / 統合テストが合格（`npm run test`、必要に応じて `npx playwright test`）

---

## コード品質・レビュー

- [ ] 変更差分（Files changed）をレビュー済み（重大な設計/パフォーマンス影響が無い）
- [ ] 不要な console.log / デバッグコードを削除済み
- [ ] 適切な型注釈・型安全が担保されている
- [ ] 重大なロジックはユニットテストでカバーしている（特に権限やバリデーション）

---

## ドキュメント・運用

- [ ] README / docs の更新が必要な場合は反映済み（該当ファイルが含まれている）
- [ ] DB マイグレーションがある場合、マイグレーションスクリプトとロールバック手順を PR に含めた
- [ ] 変更に伴う運用手順（環境変数、シークレット更新、依存サービスの変更）が記載されている

---

## セキュリティ・権限

- [ ] 新しい API は認可/認証チェックがある
- [ ] 外部への機密情報漏洩がない（トークンなどをハードコードしていない）

---

## スモークテスト（ローカル / ステージ）

### Checkout

```bash
git fetch origin
git checkout <pr-branch>
npm ci
```

### 型チェック & ビルド

```bash
npx tsc --noEmit
npm run build
```

### dev 起動（UI 関連変更がある場合）

```bash
npm run dev
```

- ブラウザで主要フローを実行（一覧表示 / 新規作成 / 編集 / 削除）
- Console と Network タブでエラーを確認

### API / DB（バックエンドがある場合）

- 必要なマイグレーションを適用してステージで動作確認

### デモモード

- `VITE_DEMO_MODE` がある場合、true/false 両方で主要フローの確認

---

## マージ方法（推奨）

- 一般的には **Squash and merge**：履歴を整理してマージ
- リリース方針に応じて **Merge commit** を選択

---

## マージ後の手順

- デプロイ自動化がある場合はデプロイジョブを監視
- スモーク（本番近似）で主要ユースケース確認
- 必要なら Hotfix 手順を準備

---

## 備考

- 重大な変更（データ移行 / 破壊的変更 / 公開 API 変更）は別途 RFC を作成し、レビューを長めに取る
