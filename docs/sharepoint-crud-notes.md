# SharePoint CRUD 実装メモ

## 概要
Schedules 機能の SharePoint 統合における CRUD 実装の技術的なメモです。

## DELETE (削除) 動作
- **HTTP ステータスコード**: 200 OK または 204 No Content
  - SharePoint REST API の DELETE は環境構成によって 200 または 204 で応答する場合があります
  - アプリケーション側は**両方のステータスコード対応**が必須です
  - 現在の実装: SharePoint クライアント側が自動的に処理します

- **IF-MATCH ヘッダー**
  - DELETE リクエストには `IF-MATCH: *` ヘッダーが必須です
  - これは SharePoint リスト アイテムの同時実行制御チェックを回避して削除を実行します
  - 実装: `src/lib/spClient.ts` の `deleteItemByTitle` で自動付与

- **削除後の UI 更新**
  - 削除リクエスト成功時、ローカル状態から該当行を削除し、選択状態もクリアします
  - スナックバー通知で「予定を削除しました」を表示します
  - ダイアログは自動的に閉じます（`clearInlineSelection()` で統一）

## PATCH (更新) 動作
- **成功時の UX**
  - スナックバー表示: 「予定を更新しました」
  - ローカル状態の該当行を新しいデータで置き換え
  - 編集ダイアログを自動クローズ、選択状態をクリア

- **失敗時の UX**
  - スナックバー表示: 「更新に失敗しました（権限・認証・ネットワークを確認）」
  - ダイアログは閉じずに残す → ユーザーは再試行または入力修正が可能
  - 入力値は保持される

## 型定義
- **SchedulesPort インターフェース**
  - `remove: (eventId: string) => Promise<void>` は必須メソッドです
  - すべてのアダプター（Demo / SharePoint / Graph）が実装する必要があります
  - オプション化していないため、環境構成時に削除機能が常に利用可能です

## テスト
- ユニットテスト: `npm run test:schedule:mini`
- E2E テスト: `npm run test:e2e` (SharePoint 連携が有効な環境)

## チームへのメモ
1. 削除後、ブラウザ再読込しても反映が確認できます（サーバー側削除の確認）
2. ネットワーク エラーで削除失敗時は、ダイアログが残った状態で再試行できます
3. 削除と同時に行の選択状態も消えるため、誤操作リスクが低くなります
